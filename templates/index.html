[[extend "layout.html"]]

[[block page_head]]
<link rel="stylesheet" href="[[=URL('static', 'css/pages/index.css')]]">
[[end]]

<div v-cloak id="hp-target" class="section">
    <div class="container">
       <div class="columns">
          <div class="column is-two-thirds">
             <p class="title">Hey, [[=username]]</p>
             <p class="subtitle">It's {{formatted_date}}. Here's your overview:</p>
             <div class="level">
                <div class="level-item level-left">
                   <p class="is-size-4 has-text-weight-semibold">Assigned to You</p>
                </div>
             </div>
             <div v-if="priority_tickets.length === 0">
                <div class="columns">
                   <div class="column">
                     <p>You don't have any incomplete tickets assigned to you.</p>
                   </div>
                </div>
             </div>
             <div v-for="t in priority_tickets" @click="goToTicket(t.id)" class="notification sluggo_clickable"
               v-bind:class = "{'is-info': !checkOverdue(t), 'is-danger': checkOverdue(t)}">
                <div class="columns">
                   <div class="column">
                      <p class="is-size-5">Ticket {{t.id}} | {{t.tag_string}} | {{t.ticket_title}}</p>
                      <p v-if="typeof(t.web_due) !== 'undefined'">Due {{formatDate(t.web_due)}}</p>
                   </div>
                   <!-- <div class="column"></div>
                   <div class="column">
                      <div class="buttons">
                         <div class="button is-inverted is-danger is-outlined">
                            <p>Complete</p>
                         </div>
                      </div>
                   </div> -->
                </div>
             </div>
             <div v-if="assigned_tickets_count > 3" class="columns">
                <div class="column">
                  <a @click="goToSelfAssignee()" class="sluggo_clickable">See all tickets assigned to you &rarr;</a>
                </div>
             </div>
            <br v-if="priority_tickets.length === 0 || priority_tickets.length === 3">
             <div>
                <p class="is-size-4 has-text-weight-semibold">Recent Updates</p>
                <article v-for="e in recent_events" @click="placeholder()" class="notification">
                   <div class="columns">
                      <!-- <div class="column">
                         <div class="">
                            <div class="level-item">
                               <img src="[[=URL('static', 'images/default.JPG')]]" width="80">
                            </div>
                            
                         </div> -->
                      <!-- </div> -->
                      <div class="column">
                         <p>User {{e.web_action_user_name}} performed action {{e.type}} with content {{e.description}}
                            on ticket {{e.related_ticket}}
                         </p>
                         <!-- <p><span class="has-text-weight-bold">Andrew Gavgavian posted on Ticket 21 "Submitting software proposal for...": </span> 
                         </p><p>"Great work! I think we can start moving this proposal forward. I cleaned up some of the wording 
                            and described some more technical mechanisms.""
                         </p> -->
                      </div>
                   </div>
                </article>
             </div>
          </div>
          <div class="column is-one-third">
             <div class="box">
                <div class="level">
                   <div class="level-item level-left">
                      <p class="is-size-4 has-text-weight-semibold">Pinned Tickets</p>
                   </div>
                   <!-- TODO: Implement easy pinned ticket modification -->
                   <!-- <div class="level-item level-right buttons">
                      <div class="button">
                         Edit
                      </div>
                   </div> -->
                </div>
               <div class="sluggo_pinned_ticket notification is-info" v-for="pt in pinned_tickets" @click="goToTicket(pt.id)">
                  <div class="columns">
                     <div class="column">
                        <p class="is-size-5">Ticket {{pt.id}} | {{pt.tag_string}} | {{pt.ticket_title}} </p>
                        <!-- <p>Due May 25, 2020.</p> -->
                     </div>
                     <!-- TODO: Determine how to expose ticket completion
                     endpoints on the homepage -->
                     <!-- <div class="column">
                        <div class="buttons">
                           <div class="button is-static">
                              <p>Complete</p>
                           </div>
                        </div>
                     </div> -->
                  <!-- TODO: Progress indicator -->
                  <!-- <div class="columns">
                     <div class="column">
                        <p class="is-size-6 has-text-weight-semibold">50% Complete (2/4)</p>
                        <progress class="progress" value="50" max="100">50%</progress>
                     </div>
                  </div> -->
               </div>
            </div>
             </div>
             <div class="box">
                <div class="level">
                   <div class="level-item level-left">
                      <p class="is-size-4 has-text-weight-semibold">Your Tags</p>
                   </div>
                </div>
                <div class="tile is-ancestor">
                   <div class="tile is-parent is-vertical">
                      <article class="sluggo_hp_tag tile is-child notification is-grey-lighter" v-for="tag in user_tags" @click="goToTag(tag.tag_id)">
                         <p>{{formatTag(tag.tag_name)}} <span v-if="tag.overdue_count > 0" class="has-text-danger">({{tag.overdue_count}} 
                            <span v-if="tag.overdue_count == 1">ticket</span><span v-if="tag.overdue_count > 1">tickets</span>
                             overdue)</span></p>
                      </article>
                   </div>
                </div>
             </div>
          </div>
       </div>
    </div>
    </div>
    
    [[block page_scripts]]
    <script>
      let user_id = "[[=XML(user_id)]]";
      let date = "[[=XML(date)]]";
      let pinned_tickets = '[[=XML(pinned_tickets)]]';
      let priority_tickets = '[[=XML(priority_tickets)]]';
      let assigned_tickets_count = '[[=XML(assigned_tickets_count)]]';
      let ticket_details_url = '[[=XML(ticket_details_url)]]';
      let tickets_url = '[[=XML(tickets_url)]]';
      let user_tags = '[[=XML(user_tags)]]';
      let recent_events ='[[=XML(recent_events)]]';
    </script>
    <script src="js/index.js"></script>
    [[end]]